#!/bin/bash

# Function to get DNS from ifconfig output
get_dns_from_ifconfig() {
    # Get DNS servers from ifconfig (for wlan0 or mobile data)
    DNS=$(ifconfig 2>/dev/null | grep -A 10 "wlan0\|rmnet" | grep "inet " | head -1 | awk '{print $3}' | cut -d: -f2)
    
    # If no DNS from ifconfig, try alternative methods
    if [ -z "$DNS" ]; then
        DNS=$(getprop net.dns1 2>/dev/null)
    fi
    
    if [ -z "$DNS" ]; then
        DNS=$(cat /etc/resolv.conf 2>/dev/null | grep nameserver | head -1 | awk '{print $2}')
    fi
    
    echo "$DNS"
}

# Get the DNS server IP
DNS=$(get_dns_from_ifconfig)

# If no DNS found, exit with error
if [ -z "$DNS" ]; then
    echo "No DNS server found."
    exit 1
fi

# Construct and execute the command
CMD="./slipstream-client --tcp-listen-port=5201 --resolver=${DNS}:5300 --domain=s.etecsa.news --keep-alive-interval=600 --congestion-control=cubic --gso=true"

echo "Running: $CMD"
$CMD
